#=====================================================================
#
# toplevel makefile for OMNeT++ libraries and programs
#
#=====================================================================

#
# Directories
#
OMNETPP_SRC_DIR =       @OMNETPP_SRC_DIR@
OMNETPP_MODELS_DIR =    @OMNETPP_MODELS_DIR@
OMNETPP_SAMPLES_DIR =   @OMNETPP_SAMPLES_DIR@

#=====================================================================
#
# Main targets
#
#=====================================================================


all: components

components: check-env all-libs all-progs install-local all-models all-samples


#=====================================================================
#
# OMNeT++ components
#
#=====================================================================


#
# Group targets. Note that utils has to be built before libs and progs
# because tcl2c might be needed to build tkenv or gned.
#
all-libs: utils sim envir cmdenv tkenv tvenv

all-progs: utils nedc gned plove

all-models: support

all-samples: dyna fddi fifo1 fifo2 hcube hist nim pvmex token


#
# Libraries
#

sim:
	cd $(OMNETPP_SRC_DIR)/sim; $(MAKE)

envir:
	cd $(OMNETPP_SRC_DIR)/envir; $(MAKE)

cmdenv:
	cd $(OMNETPP_SRC_DIR)/cmdenv; $(MAKE)

tkenv:
	cd $(OMNETPP_SRC_DIR)/tkenv; $(MAKE)

tvenv:
	cd $(OMNETPP_SRC_DIR)/tvenv; $(MAKE)


#
# Programs
#

nedc:
	cd $(OMNETPP_SRC_DIR)/nedc; $(MAKE)

gned:
	cd $(OMNETPP_SRC_DIR)/gned; $(MAKE)

plove:
	@ # needs no build

utils:
	cd $(OMNETPP_SRC_DIR)/utils; $(MAKE)

#
# Models
#

support:
	cd $(OMNETPP_MODELS_DIR)/support; $(MAKE)

#
# Sample programs
#

dyna:
	cd $(OMNETPP_SAMPLES_DIR)/dyna; $(MAKE)

fddi:
	cd $(OMNETPP_SAMPLES_DIR)/fddi; $(MAKE)

fifo1:
	cd $(OMNETPP_SAMPLES_DIR)/fifo1; $(MAKE)

fifo2:
	cd $(OMNETPP_SAMPLES_DIR)/fifo2; $(MAKE)

hcube:
	cd $(OMNETPP_SAMPLES_DIR)/hcube; $(MAKE)

hist:
	cd $(OMNETPP_SAMPLES_DIR)/hist; $(MAKE)

nim:
	cd $(OMNETPP_SAMPLES_DIR)/nim; $(MAKE)

pvmex:
	cd $(OMNETPP_SAMPLES_DIR)/pvmex; $(MAKE)

token:
	cd $(OMNETPP_SAMPLES_DIR)/token; $(MAKE)


#=====================================================================
#
# Utilities
#
#=====================================================================

check-env:
	@ if echo $$PATH | grep -q "@OMNETPP_BIN_DIR@"; then :; else \
	  echo ' *** Error: @OMNETPP_BIN_DIR@ is not in the path!'; exit 1; \
	fi
	@ if echo $$LD_LIBRARY_PATH | grep -q "@OMNETPP_LIB_DIR@"; then :; else \
	  echo ' *** Warning: @OMNETPP_LIB_DIR@ is not in LD_LIBRARY_PATH!'; \
	fi

clean:
	for i in sim envir tkenv tvenv cmdenv nedc gned plove utils; do \
	    (cd $(OMNETPP_SRC_DIR)/$$i; $(MAKE) clean); \
	done
	for i in `echo $(OMNETPP_MODELS_DIR)/*`; do \
	    (cd $$i; $(MAKE) clean); \
	done
	for i in `echo $(OMNETPP_SAMPLES_DIR)/*`; do \
	    (cd $$i; $(MAKE) clean); \
	done

depend:
	for i in sim envir tkenv tvenv cmdenv nedc gned plove utils; do \
	    (cd $(OMNETPP_SRC_DIR)/$$i; $(MAKE) depend); \
	done
	for i in `echo $(OMNETPP_MODELS_DIR)/*`; do \
	    (cd $$i; $(MAKE) depend); \
	done
	for i in `echo $(OMNETPP_SAMPLES_DIR)/*`; do \
	    (cd $$i; $(MAKE) depend); \
	done

install-local:
	for i in sim envir tkenv tvenv cmdenv nedc gned plove utils; do \
	    (cd $(OMNETPP_SRC_DIR)/$$i; $(MAKE) install-local); \
	done

