#=====================================================================
#
# toplevel makefile for OMNeT++ libraries and programs
#
#=====================================================================

#
# Directories
#
OMNETPP_SRC_DIR =       @OMNETPP_SRC_DIR@
OMNETPP_MODELS_DIR =    @OMNETPP_MODELS_DIR@
OMNETPP_SAMPLES_DIR =   @OMNETPP_SAMPLES_DIR@

#=====================================================================
#
# Main targets
#
#=====================================================================


all: components

components: all_libs all_progs all_models all_samples


#=====================================================================
#
# OMNeT++ components
#
#=====================================================================


all_libs: sim envir cmdenv tkenv tvenv

all_progs: nedc gned plove utils

all_models: support

all_samples: dyna fddi fifo1 fifo2 hcube hist nim pvmex token


#
# Libraries
#

sim:
	cd $(OMNETPP_SRC_DIR)/sim; $(MAKE)

envir:
	cd $(OMNETPP_SRC_DIR)/envir; $(MAKE)

cmdenv:
	cd $(OMNETPP_SRC_DIR)/cmdenv; $(MAKE)

tkenv:
	cd $(OMNETPP_SRC_DIR)/tkenv; $(MAKE)

tvenv:
	cd $(OMNETPP_SRC_DIR)/tvenv; $(MAKE)


#
# Programs
#

nedc:
	cd $(OMNETPP_SRC_DIR)/nedc; $(MAKE)

gned:
	cd $(OMNETPP_SRC_DIR)/gned; $(MAKE)

plove:
	@ # needs no build

utils:
	cd $(OMNETPP_SRC_DIR)/utils; $(MAKE)

#
# Models
#

support:
	cd $(OMNETPP_MODELS_DIR)/support; $(MAKE)

#
# Sample programs
#

dyna:
	cd $(OMNETPP_SAMPLES_DIR)/dyna; $(MAKE)

fddi:
	cd $(OMNETPP_SAMPLES_DIR)/fddi; $(MAKE)

fifo1:
	cd $(OMNETPP_SAMPLES_DIR)/fifo1; $(MAKE)

fifo2:
	cd $(OMNETPP_SAMPLES_DIR)/fifo2; $(MAKE)

hcube:
	cd $(OMNETPP_SAMPLES_DIR)/hcube; $(MAKE)

hist:
	cd $(OMNETPP_SAMPLES_DIR)/hist; $(MAKE)

nim:
	cd $(OMNETPP_SAMPLES_DIR)/nim; $(MAKE)

pvmex:
	cd $(OMNETPP_SAMPLES_DIR)/pvmex; $(MAKE)

token:
	cd $(OMNETPP_SAMPLES_DIR)/token; $(MAKE)


#=====================================================================
#
# Utilities
#
#=====================================================================

clean:
	for i in sim envir tkenv tvenv cmdenv nedc gned plove utils; do \
	    (cd $(OMNETPP_SRC_DIR)/$$i; $(MAKE) clean); \
	done
	for i in `echo $(OMNETPP_MODELS_DIR)/*`; do \
	    (cd $$i; $(MAKE) clean); \
	done
	for i in `echo $(OMNETPP_SAMLES_DIR)/*`; do \
	    (cd $$i; $(MAKE) clean); \
	done

depend:
	for i in sim envir tkenv tvenv cmdenv nedc gned plove utils; do \
	    (cd $(OMNETPP_SRC_DIR)/$$i; $(MAKE) depend); \
	done
	for i in `echo $(OMNETPP_MODELS_DIR)/*`; do \
	    (cd $$i; $(MAKE) depend); \
	done
	for i in `echo $(OMNETPP_SAMLES_DIR)/*`; do \
	    (cd $$i; $(MAKE) depend); \
	done

dist:
	echo 'to be done'

