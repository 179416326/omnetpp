\chapter{Documenting NED and Messages}
\label{cha:neddoc}

\section{Overview}

{\opp} provides a tool which can generate HTML documentation from NED files
and message definitions. Like Javadoc and Doxygen, the NED documentation tool
makes use of source code comments. The generated HTML documentation
lists all modules, channels, messages, etc., and presents their details including
description, gates, parameters, assignable submodule parameters and
syntax-highlighted source code. The documentation also includes clickable
network diagrams (exported from the graphical editor) and usage diagrams as
well as inheritance diagrams.

The documentation tool integrates with Doxygen, meaning that it can
hyperlink simple modules and message classes to their C++ implementation
classes in the Doxygen documentation. If you also generate the C++
documentation with some Doxygen features turned on (such as
\textit{inline-sources} and \textit{referenced-by-relation}, combined with
\textit{extract-all}, \textit{extract-private} and
\textit{extract-static}), the result is an easily browsable and very
informative presentation of the source code. Of course, one still has to
write documentation comments in the code.

In the 4.0 version, the documentation tool is part of the Eclipse-based
simulation IDE.


\section{Documentation comments}

Documentation is embedded in normal comments. All \texttt{//} comments
that are in the ``right place'' (from the documentation tool's
point of view) will be included in the generated documentation.
  \footnote{In contrast, Javadoc and Doxygen use special comments (those
     beginning with \texttt{/**}, \texttt{///}, \texttt{//<} or a similar
     marker) to distinguish documentation from ``normal'' comments in the
     source code. In {\opp} there's no need for that: NED and the message
     syntax is so compact that practically all comments one would want to write
     in them can serve documentation purposes.}

Example:

\begin{ned}
//
// An ad-hoc traffic generator to test the Ethernet models.
//
simple Gen
{
    parameters:
        string destAddress;  // destination MAC address
        int protocolId;      // value for SSAP/DSAP in Ethernet frame
        double waitMean @unit(s); // mean for exponential interarrival times
    gates:
        output out;  // to Ethernet LLC
}
\end{ned}

You can also place comments above parameters and gates. This is useful
if they need long explanations. Example:

\begin{ned}
//
// Deletes packets and optionally keeps statistics.
//
simple Sink
{
    parameters:
        // You can turn statistics generation on and off. This is
        // a very long comment because it has to be described what
        // statistics are collected (or not).
        bool collectStatistics = default(true);
    gates:
        input in;
}
\end{ned}

\subsection{Private comments}

If you want a comment line \textit{not} to appear in the documentation,
begin it with \texttt{//\#}. Those lines will be ignored by the
documentation tool, and can be used to make ``private'' comments
like \texttt{FIXME} or \texttt{TODO}, or to comment out unused code.

\begin{ned}
//
// An ad-hoc traffic generator to test the Ethernet models.
//# TODO above description needs to be refined
//
simple Gen
{
    parameters:
        string destAddress;  // destination MAC address
        int protocolId;      // value for SSAP/DSAP in Ethernet frame
        //# double burstiness;  -- not yet supported
        double waitMean @unit(s); // mean for exponential interarrival times
    gates:
        output out;  // to Ethernet LLC
}
\end{ned}


\subsection{More on comment placement}

Comments should be written where nedtool will find them.
This is a) immediately above the documented item, or b) after the
documented item, on the same line.

In the former case, make sure there's no blank line left
between the comment and the documented item. Blank lines
detach the comment from the documented item.

Example:
\begin{ned}
// This is wrong! Because of the blank line, this comment is not
// associated with the following simple module!

simple Gen
{
    ...
}
\end{ned}

Do not try to comment groups of parameters together. The result
will be awkward.

\section{Text layout and formatting}

\subsection{Paragraphs and lists}

If you write longer descriptions, you'll need text formatting capabilities.
Text formatting works like in Javadoc or Doxygen -- you can break up the
text into paragraphs and create bulleted/numbered lists without
special commands, and use HTML for more fancy formatting.

Paragraphs are separated by empty lines, like in LaTeX or Doxygen.
Lines beginning with `\ttt{-}' will be turned into bulleted lists,
and lines beginning with `\ttt{-\#}' into numbered lists.

Example:

\begin{ned}
//
// Ethernet MAC layer. MAC performs transmission and reception of frames.
//
// Processing of frames received from higher layers:
// - sends out frame to the network
// - no encapsulation of frames -- this is done by higher layers.
// - can send PAUSE message if requested by higher layers (PAUSE protocol,
//   used in switches). PAUSE is not implemented yet.
//
// Supported frame types:
// -# IEEE 802.3
// -# Ethernet-II
//
\end{ned}


\subsection{Special tags}

The documentation tool understands the following tags and will render them accordingly:
\ttt{@author}, \ttt{@date}, \ttt{@todo}, \ttt{@bug}, \ttt{@see}, \ttt{@since},
\ttt{@warning}, \ttt{@version}. Example usage:

\begin{ned}
//
// @author Jack Foo
// @date 2005-02-11
//
\end{ned}


\subsection{Text formatting using HTML}

Common HTML tags are understood as formatting commands.
The most useful tags are: \ttt{<i>..</i>} (italic),
\ttt{<b>..</b>} (bold), \ttt{<tt>..</tt>} (typewriter font),
\ttt{<sub>..</sub>} (subscript), \ttt{<sup>..</sup>} (superscript),
\ttt{<br>} (line break), \ttt{<h3>} (heading),
\ttt{<pre>..</pre>} (preformatted text) and \ttt{<a href=..>..</a>} (link),
as well as a few other tags used for table creation (see below).
For example, \texttt{<i>Hello</i>} will be rendered as ``\textit{Hello}''
(using an italic font).

The complete list of HTML tags interpreted by the documentation tool are:
\texttt{<a>}, \texttt{<b>}, \texttt{<body>}, \texttt{<br>}, \texttt{<center>},
\texttt{<caption>}, \texttt{<code>}, \texttt{<dd>}, \texttt{<dfn>}, \texttt{<dl>},
\texttt{<dt>}, \texttt{<em>}, \texttt{<form>}, \texttt{<font>}, \texttt{<hr>},
\texttt{<h1>}, \texttt{<h2>}, \texttt{<h3>}, \texttt{<i>}, \texttt{<input>}, \texttt{<img>},
\texttt{<li>}, \texttt{<meta>}, \texttt{<multicol>}, \texttt{<ol>}, \texttt{<p>}, \texttt{<small>},
\texttt{<span>}, \texttt{<strong>},
\texttt{<sub>}, \texttt{<sup>}, \texttt{<table>}, \texttt{<td>}, \texttt{<th>}, \texttt{<tr>},
\texttt{<tt>}, \texttt{<kbd>}, \texttt{<ul>}, \texttt{<var>}.

Any tags not in the above list will not be interpreted as formatting commands
but will be printed verbatim -- for example, \texttt{<what>bar</what>}
will be rendered literally as ``<what>bar</what>'' (unlike HTML where
unknown tags are simply ignored, i.e. HTML would display ``bar'').

If you insert links to external pages (web sites), its useful to add
the \ttt{target="\_blank"} attribute to ensure pages come up in a new
browser window and not just in the current frame which looks awkward.
(Alternatively, you can use the \ttt{target="\_top"} attribute
which replaces all frames in the current browser).

Examples:

\begin{ned}
//
// For more info on Ethernet and other LAN standards, see the
// <a href="http://www.ieee802.org/" target="_blank">IEEE 802
// Committee's site</a>.
//
\end{ned}

You can also use the \ttt{<a href=..>} tag to create links within the page:

\begin{ned}
//
// See the <a href="#resources">resources</a> in this page.
// ...
// <a name="resources"><b>Resources</b></a>
// ...
//
\end{ned}

You can use the \texttt{<pre>..</pre>} HTML tag to insert source code examples
into the documentation. Line breaks and indentation will be preserved,
but HTML tags continue to be interpreted (or you can turn them off
with \texttt{<nohtml>}, see later).

Example:

\begin{ned}
// <pre>
// // my preferred way of indentation in C/C++ is this:
// <b>for</b> (<b>int</b> i=0; i<10; i++)
// {
//     printf(<i>"%d\n"</i>, i);
// }
// </pre>
\end{ned}

will be rendered as

\begin{Verbatim}[commandchars=\\\{\}]
// my preferred way of indentation in C/C++ is this:
\textbf{for} (\textbf{int} i=0; i<10; i++)
\{
    printf(\textit{"%d{\textbackslash}n"}, i);
\}
\end{Verbatim}

HTML is also the way to create tables. The example below

\begin{ned}
//
// <table border="1">
//   <tr>  <th>#</th> <th>number</th> </tr>
//   <tr>  <td>1</td> <td>one</td>    </tr>
//   <tr>  <td>2</td> <td>two</td>    </tr>
//   <tr>  <td>3</td> <td>three</td>  </tr>
// </table>
//
\end{ned}

will be rendered approximately as:

\begin{longtable}{|l|l|}
\hline
\tabheadcol
\tbf{\#} & \tbf{number} \\\hline
1 & one \\\hline
2 & two \\\hline
3 & three \\\hline
\end{longtable}


\subsection{Escaping HTML tags}

Sometimes may need to off interpreting HTML tags (\ttt{<i>}, \ttt{<b>}, etc.)
as formatting instructions, and rather you want them to appear as literal
\ttt{<i>}, \ttt{<b>} texts in the documentation. You can achieve this via
surrounding the text with the \ttt{<nohtml>}...\ttt{</nohtml>} tag.
For example,

\begin{ned}
// Use the <nohtml><i></nohtml> tag (like <tt><nohtml><i>this</i></nohtml><tt>)
// to write in <i>italic</i>.
\end{ned}

will be rendered as ``Use the <i> tag (like \texttt{<i>this</i>}) to write
in \textit{italic}.''

\ttt{<nohtml>}...\ttt{</nohtml>} will also prevent \fprog{opp\_neddoc}
from hyperlinking words that are accidentally the same as an existing
module or message name. Prefixing the word with a backslash will achieve
the same. That is, either of the following will do:

\begin{ned}
// In <nohtml>IP</nohtml> networks, routing is...
\end{ned}

\begin{ned}
// In \IP networks, routing is...
\end{ned}

Both will prevent hyperlinking the word \textit{IP} if you happen to have
an \ttt{IP} module in the NED files.



\section{Customizing and adding pages}

\subsection{Adding a custom title page}

The title page is the one that appears in the main frame after
opening the documentation in the browser. By default it contains
a boilerplate text with the generic title \textit{``{\opp} Model Documentation''}.
You probably want to customize that, and at least change the title
to the name of the documented simulation model.

You can supply your own version of the title page adding a \ttt{@titlepage}
directive to a file-level comment (a comment that appears at the top of
a NED file, but is separated from the first \ttt{import}, \ttt{channel},
\ttt{module}, etc. definition by at least one blank line).
In theory you can place your title page definition into
any NED or MSG file, but it is probably a good idea to create
a separate \ttt{package.ned} file for it.

The lines you write after the \ttt{@titlepage} line up to the next
\ttt{@page} line (see later) or the end of the comment will be used
as the title page.
You probably want to begin with a title because the documentation
tool doesn't add one (it lets you have full control over the
page contents). You can use the \ttt{<h1>..</h1>} HTML tag
to define a title.

Example:

\begin{ned}
//
// @titlepage
// <h1>Ethernet Model Documentation</h1>
//
// This documents the Ethernet model created by David Wu and refined by Andras
// Varga at CTIE, Monash University, Melbourne, Australia.
//
\end{ned}


\subsection{Adding extra pages}

You can add new pages to the documentation in a similar way as customizing
the title page. The directive to be used is \ttt{@page}, and it can
appear in any file-level comment (see above).

The syntax of the \ttt{@page} directive is the following:

\begin{ned}
// @page filename.html, Title of the Page
\end{ned}

Please choose a file name that doesn't collide with the files generated
by the documentation tool (such as \ttt{index.html}).
The page title you supply will appear on the top of the page as well as
in the page index.

The lines after the \ttt{@page} line up to the next \ttt{@page} line
or the end of the comment will be used as the page body.
You don't need to add a title because the documentation tool
automatically adds one.

Example:
\begin{ned}
//
// @page structure.html, Directory Structure
//
// The model core model files and the examples have been placed
// into different directories. The <tt>examples/</tt> directory...
//
//
// @page examples.html, Examples
// ...
//
\end{ned}

You can create links to the generated pages using standard HTML,
using the \ttt{<a href="...">...</a>} tag. All HTML files are
placed in a single directory, so you don't have to worry about
specifying directories.

Example:
\begin{ned}
//
// @titlepage
// ...
// The structure of the model is described <a href="structure.html">here</a>.
//
\end{ned}


\subsection{Incorporating externally created pages}

You may want to create pages outside the documentation tool
(e.g. using a HTML editor) and include them in the documentation.
This is possible, all you have to do is declare such pages with
the \ttt{@externalpage} directive in any of the NED files, and
they will be added to the page index. The pages can then be linked to
from other pages using the HTML \ttt{<a href="...">...</a>} tag.

The \ttt{@externalpage} directive is similar in syntax to \ttt{@page}:

\begin{ned}
// @externalpage filename.html, Title of the Page
\end{ned}

The documentation tool does not check if the page exists
or not. It is your responsibility to copy it manually into
the directory of the generated documentation, and to make
sure the hyperlink works.


