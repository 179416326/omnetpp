#
# Global definitions
#
!include ..\..\configuser.vc

# Make sure that output locations are set
!if "$(OMNETPP_BIN_DIR)"==""
!error OMNETPP_BIN_DIR must be correctly set
!endif
!if "$(OMNETPP_OUT_DIR)"==""
!error OMNETPP_OUT_DIR must be correctly set
!endif
!if "$(OMNETPP_LIB_DIR)"==""
!error OMNETPP_LIB_DIR must be correctly set
!endif

#
# Local definitions
#
LIBNAME=scave$D
O=$(OMNETPP_OUT_DIR)/$(TOOLCHAIN_NAME)-$(MODE)/src/scave
L=$(OMNETPP_LIB_DIR)/$(TOOLCHAIN_NAME)

COPTS= $(CFLAGS) $(XML_CFLAGS) -I. -I../common -I"$(OMNETPP_INCL_DIR)/platdep" /Fd"$O/$(LIBNAME).pdb"
IMPLIBS= $O/../common/common$D.lib $(XML_LIBS)

OBJS= $O/arraybuilder.obj $O/channel.obj $O/commonnodes.obj $O/compoundfilter.obj \
      $O/dataflowmanager.obj $O/datasorter.obj $O/diffquot.obj \
      $O/filewriter.obj $O/filternodes.obj $O/customfilter.obj $O/stddev.obj \
      $O/idlist.obj $O/mergernodes.obj $O/nodetype.obj $O/nodetyperegistry.obj \
      $O/resultfilemanager.obj $O/slidingwinavg.obj \
      $O/vectorfilereader.obj $O/vectorfilewriter.obj $O/windowavg.obj \
      $O/xyplotnode.obj $O/indexedvectorfile.obj \
      $O/vectorfileindexer.obj $O/indexfile.obj $O/scaveutils.obj \
      $O/scaveexception.obj $O/enumtype.obj $O/export.obj $O/teenode.obj \
      $O/indexedvectorfilereader.obj $O/xyarray.obj $O/fields.obj

!if "$(LIB_SUFFIX)"==".dll"
COPTS= $(COPTS) -DSCAVE_EXPORT
!endif

#
# Automatic rules
#
.SUFFIXES : .cc

{.}.cc{$O}.obj:
	$(CXX) /Fo"$@" $(COPTS) /c /Tp $<


#
# Targets (TBD: build dll)
#
all : $O/$(LIBNAME)$(LIB_SUFFIX) $O/scavetool.exe

$O/$(LIBNAME).lib : $(OBJS) $L
	$(AR) /out:"$@" $(OBJS)
	copy $(O:/=\)\$(LIBNAME).lib $(L:/=\)
	-copy /b $(O:/=\)\$(LIBNAME).pdb $(L:/=\) 2>nul

$O/$(LIBNAME).dll : $(OBJS) $L
	$(SHLIB_LD) /out:"$@" /subsystem:console $(OBJS) $(IMPLIBS)
	copy $(O:/=\)\$(LIBNAME).dll $(OMNETPP_BIN_DIR:/=\)
	-copy /b $(O:/=\)\$(LIBNAME).dll.manifest $(OMNETPP_BIN_DIR:/=\) 2>nul
	copy $(O:/=\)\$(LIBNAME).lib $(L:/=\)
	-copy /b $(O:/=\)\$(LIBNAME).pdb $(L:/=\) 2>nul

$O/scavetool.exe : $O/scavetool.obj $O/$(LIBNAME)$(LIB_SUFFIX)
	$(LINK) $(LDFLAGS) /nologo /out:"$@" $O/scavetool.obj $(O:/=\)\$(LIBNAME).lib $(IMPLIBS)
	copy $(O:/=\)\scavetool.exe $(OMNETPP_BIN_DIR:/=\)
	-copy $(O:/=\)\scavetool.exe.manifest $(OMNETPP_BIN_DIR:/=\) 2>nul

$O/scavetool.obj : scavetool.cc $O
	@: Note: not in OBJS because scavetool.cc must be compiled *without* -DSCAVE_EXPORT
	$(CXX) $(CFLAGS) -I. -I../common -I"$(OMNETPP_INCL_DIR)/platdep" /c /Fo"$@" /Tp scavetool.cc

$(OBJS): $O

$O $L:
	md $(@:/=\)

doc:
	$(DOXYGEN:/=\) doxy.cfg

depend:
	$(MAKEDEPEND) -I. -I../common -fMakefile.vc -P^$O/ -- *.cc

clean:
	-rmdir /s /q $(O:/=\) 2>nul
	-del /q $(L:/=\)\$(LIBNAME).* $(OMNETPP_LIB_DIR:/=\)\$(LIBNAME).* 2>nul
	-cd $(OMNETPP_BIN_DIR:/=\) && del /q scavetool.exe* 2>nul

# DO NOT DELETE THIS LINE -- make depend depends on it.
$O/arraybuilder.obj: arraybuilder.cc \
  channel.h \
  arraybuilder.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  commonnodes.h \
  xyarray.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/progressmonitor.h
$O/channel.obj: channel.cc \
  channel.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h
$O/commonnodes.obj: commonnodes.cc \
  commonnodes.h \
  channel.h \
  node.h \
  nodetype.h \
  scavedefs.h \
  ../common/commonutil.h \
  ../common/bigdecimal.h \
  ../common/commondefs.h \
  ../common/exception.h \
  dataflowmanager.h \
  ../common/progressmonitor.h
$O/compoundfilter.obj: compoundfilter.cc \
  ../common/commonutil.h \
  compoundfilter.h \
  filternodes.h \
  nodetyperegistry.h \
  ../common/commondefs.h \
  ../common/exception.h \
  nodetype.h \
  commonnodes.h \
  dataflowmanager.h \
  node.h \
  ../common/progressmonitor.h \
  channel.h \
  scavedefs.h \
  ../common/bigdecimal.h
$O/customfilter.obj: customfilter.cc \
  channel.h \
  customfilter.h \
  scaveutils.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  commonnodes.h \
  ../common/expression.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/progressmonitor.h \
  ../common/stringutil.h
$O/dataflowmanager.obj: dataflowmanager.cc \
  channel.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  ../common/progressmonitor.h
$O/datasorter.obj: datasorter.cc \
  resultfilemanager.h \
  ../common/commonutil.h \
  datasorter.h \
  ../common/stringutil.h \
  idlist.h \
  enumtype.h \
  ../common/exception.h \
  statistics.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  ../common/commondefs.h \
  scaveutils.h \
  ../common/patternmatcher.h \
  fields.h
$O/diffquot.obj: diffquot.cc \
  channel.h \
  diffquot.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  commonnodes.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/progressmonitor.h
$O/enumtype.obj: enumtype.cc \
  ../common/stringtokenizer.h \
  scaveutils.h \
  enumtype.h \
  ../common/commondefs.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  ../common/exception.h
$O/export.obj: export.cc \
  ../common/opp_ctype.h \
  scaveutils.h \
  export.h \
  ../common/commondefs.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  ../common/exception.h \
  xyarray.h \
  resultfilemanager.h \
  datasorter.h \
  idlist.h \
  enumtype.h \
  ../common/commonutil.h \
  statistics.h \
  ../common/patternmatcher.h \
  fields.h \
  ../common/stringutil.h
$O/fields.obj: fields.cc \
  ../common/commonutil.h \
  ../common/stringutil.h \
  fields.h \
  ../common/commondefs.h \
  ../common/exception.h \
  resultfilemanager.h \
  ../common/patternmatcher.h \
  scaveutils.h \
  idlist.h \
  enumtype.h \
  statistics.h \
  scavedefs.h \
  ../common/bigdecimal.h
$O/filewriter.obj: filewriter.cc \
  channel.h \
  filewriter.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  commonnodes.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/progressmonitor.h
$O/filternodes.obj: filternodes.cc \
  channel.h \
  filternodes.h \
  ../common/stringutil.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  commonnodes.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/progressmonitor.h
$O/idlist.obj: idlist.cc \
  idlist.h \
  resultfilemanager.h \
  ../common/stringutil.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  ../common/commondefs.h \
  ../common/exception.h \
  enumtype.h \
  ../common/commonutil.h \
  statistics.h \
  scaveutils.h
$O/indexedvectorfile.obj: indexedvectorfile.cc \
  ../common/exception.h \
  ../common/linetokenizer.h \
  channel.h \
  ../common/stringutil.h \
  indexedvectorfile.h \
  scaveutils.h \
  ../common/commondefs.h \
  ../common/commonutil.h \
  node.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  ../common/filereader.h \
  indexfile.h \
  nodetype.h \
  resultfilemanager.h \
  statistics.h \
  dataflowmanager.h \
  ../common/progressmonitor.h \
  idlist.h \
  enumtype.h
$O/indexedvectorfilereader.obj: indexedvectorfilereader.cc \
  ../common/opp_ctype.h \
  channel.h \
  scaveutils.h \
  vectorfilereader.h \
  indexedvectorfilereader.h \
  ../common/commondefs.h \
  ../common/commonutil.h \
  node.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  nodetype.h \
  ../common/filereader.h \
  ../common/linetokenizer.h \
  resultfilemanager.h \
  dataflowmanager.h \
  ../common/progressmonitor.h \
  idlist.h \
  enumtype.h \
  statistics.h \
  indexfile.h
$O/indexfile.obj: indexfile.cc \
  ../common/exception.h \
  ../common/filereader.h \
  ../common/linetokenizer.h \
  ../common/stringutil.h \
  scaveutils.h \
  scaveexception.h \
  indexfile.h \
  ../common/commondefs.h \
  ../common/commonutil.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  statistics.h
$O/mergernodes.obj: mergernodes.cc \
  channel.h \
  mergernodes.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  commonnodes.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/progressmonitor.h
$O/nodetype.obj: nodetype.cc \
  ../common/commonutil.h \
  nodetype.h \
  ../common/commondefs.h \
  ../common/exception.h \
  dataflowmanager.h \
  node.h \
  ../common/progressmonitor.h \
  channel.h \
  scavedefs.h \
  ../common/bigdecimal.h
$O/nodetyperegistry.obj: nodetyperegistry.cc \
  ../common/commonutil.h \
  nodetyperegistry.h \
  ../common/stringtokenizer.h \
  arraybuilder.h \
  vectorfilereader.h \
  vectorfilewriter.h \
  indexedvectorfile.h \
  indexedvectorfilereader.h \
  filewriter.h \
  windowavg.h \
  slidingwinavg.h \
  filternodes.h \
  mergernodes.h \
  xyplotnode.h \
  diffquot.h \
  customfilter.h \
  stddev.h \
  teenode.h \
  ../common/commondefs.h \
  ../common/exception.h \
  node.h \
  nodetype.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  dataflowmanager.h \
  ../common/progressmonitor.h \
  channel.h \
  commonnodes.h \
  xyarray.h \
  ../common/filereader.h \
  ../common/linetokenizer.h \
  resultfilemanager.h \
  idlist.h \
  enumtype.h \
  statistics.h \
  scaveutils.h \
  indexfile.h \
  ../common/expression.h \
  ../common/stringutil.h
$O/octaveexport.obj: octaveexport.cc \
  ../common/opp_ctype.h \
  octaveexport.h \
  ../common/commondefs.h \
  scavedefs.h \
  xyarray.h \
  ../common/exception.h \
  ../common/bigdecimal.h
$O/resultfilemanager.obj: resultfilemanager.cc \
  ../common/opp_ctype.h \
  ../common/matchexpression.h \
  ../common/patternmatcher.h \
  ../common/filereader.h \
  ../common/linetokenizer.h \
  ../common/stringtokenizer.h \
  indexfile.h \
  scaveutils.h \
  resultfilemanager.h \
  ../common/commonutil.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  statistics.h \
  ../common/bigdecimal.h \
  idlist.h \
  enumtype.h
$O/scaveexception.obj: scaveexception.cc \
  scaveexception.h \
  ../common/commondefs.h \
  scavedefs.h \
  ../common/exception.h \
  ../common/bigdecimal.h
$O/scavetool.obj: scavetool.cc \
  ../utils/ver.h \
  resultfilemanager.h \
  nodetype.h \
  nodetyperegistry.h \
  dataflowmanager.h \
  vectorfilereader.h \
  vectorfilewriter.h \
  vectorfileindexer.h \
  filternodes.h \
  filewriter.h \
  arraybuilder.h \
  export.h \
  ../common/stringutil.h \
  scaveutils.h \
  idlist.h \
  enumtype.h \
  ../common/exception.h \
  ../common/commonutil.h \
  statistics.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  ../common/commondefs.h \
  node.h \
  ../common/progressmonitor.h \
  channel.h \
  ../common/filereader.h \
  ../common/linetokenizer.h \
  commonnodes.h \
  xyarray.h \
  datasorter.h \
  ../common/patternmatcher.h \
  fields.h
$O/scaveutils.obj: scaveutils.cc \
  scaveutils.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  ../common/commondefs.h \
  ../common/exception.h
$O/slidingwinavg.obj: slidingwinavg.cc \
  channel.h \
  slidingwinavg.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  commonnodes.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/progressmonitor.h
$O/stddev.obj: stddev.cc \
  channel.h \
  stddev.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  commonnodes.h \
  xyarray.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/progressmonitor.h
$O/teenode.obj: teenode.cc \
  channel.h \
  teenode.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  commonnodes.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/progressmonitor.h
$O/vectorfileindexer.obj: vectorfileindexer.cc \
  ../common/opp_ctype.h \
  ../common/stringutil.h \
  scaveutils.h \
  scaveexception.h \
  ../common/filereader.h \
  ../common/linetokenizer.h \
  indexfile.h \
  vectorfileindexer.h \
  ../common/commondefs.h \
  ../common/commonutil.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  statistics.h \
  resultfilemanager.h \
  ../common/progressmonitor.h \
  idlist.h \
  enumtype.h
$O/vectorfilereader.obj: vectorfilereader.cc \
  ../common/opp_ctype.h \
  channel.h \
  scaveutils.h \
  scaveexception.h \
  vectorfilereader.h \
  ../common/commondefs.h \
  ../common/commonutil.h \
  node.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  nodetype.h \
  ../common/filereader.h \
  ../common/linetokenizer.h \
  resultfilemanager.h \
  dataflowmanager.h \
  ../common/progressmonitor.h \
  idlist.h \
  enumtype.h \
  statistics.h
$O/vectorfilewriter.obj: vectorfilewriter.cc \
  channel.h \
  vectorfilewriter.h \
  ../common/stringutil.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  nodetype.h \
  resultfilemanager.h \
  dataflowmanager.h \
  ../common/progressmonitor.h \
  idlist.h \
  enumtype.h \
  statistics.h \
  scaveutils.h
$O/windowavg.obj: windowavg.cc \
  channel.h \
  windowavg.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  commonnodes.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/progressmonitor.h
$O/xyarray.obj: xyarray.cc \
  xyarray.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  ../common/commondefs.h \
  ../common/exception.h
$O/xyplotnode.obj: xyplotnode.cc \
  channel.h \
  xyplotnode.h \
  ../common/commonutil.h \
  node.h \
  ../common/commondefs.h \
  ../common/exception.h \
  scavedefs.h \
  ../common/bigdecimal.h \
  commonnodes.h \
  nodetype.h \
  dataflowmanager.h \
  ../common/progressmonitor.h
