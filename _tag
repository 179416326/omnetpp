#
# Tag format: omnetpp-2_0b1
#

if [ ! -f configure.in ]; then
    echo 'Must be called in top-level omnetpp dir!'
    exit
fi

# cvstag and release names...
relname=$1
cvstag=`echo $relname | sed 's/\./_/g'`

# check tag format
if echo $cvstag | grep -q '^omnetpp-[0-9]\+_[0-9]\+b\?[0-9]*$'; then
    echo "relname: $relname, cvstag: $cvstag"
else
    echo "usage: $0 <relname>.  relname looks like: omnetpp-2.0b1"
    exit
fi

# update ChangeLog files (remove earlier marker line if exists)
for i in `find . -name ChangeLog`; do
    line="------ $relname released ------"
    sed "/^$line/d" $i > /tmp/xxx
    echo '' >> /tmp/xxx
    echo $line >> /tmp/xxx
    sed "/^$/d" /tmp/xxx > $i
done

# enter tag into CVS (move tag if exists)
echo $relname > Version
cvs commit -m "regenerated by omnetpp/_tag" Version
cvs tag -RF $cvstag ../omnetpp

