if [ ! -f Version ]; then
    echo 'Must be called in top-level omnetpp dir!'
    exit
fi

# cvstag and release names...
relname=`cat Version`
cvstag=`echo $relname | sed 's/\./_/g'`

# check tag format
if echo $relname | grep -q '^omnetpp-[0-9]\+\.[0-9]\+b\?[0-9]*$'; then
    echo "About to tag with the following data:"
    echo "  Release: $relname"
    echo "  CVS tag: $cvstag"
    echo "Enter to continue..."
    read
else
    echo "usage: $0 <relname>.  relname looks like: omnetpp-2.0b1"
    exit 1
fi

# update ChangeLog files (remove earlier marker line if exists)
for i in `find . -name ChangeLog`; do
    line="------ $relname released ------"
    sed "/^$line/d" $i > /tmp/xxx
    echo '' >> /tmp/xxx
    echo $line >> /tmp/xxx
    sed "/^$/d" /tmp/xxx > $i
done
cvs commit -m "--$relname released-- line added to ChangeLog by omnetpp/_tag"

# enter tag into CVS (move tag if exists)
echo $relname > Version
cvs -Q commit -m "regenerated by omnetpp/_tag" Version
cvs -Q tag -RF $cvstag ../omnetpp

