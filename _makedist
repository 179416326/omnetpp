#
# make OMNeT++ distribution
#

# version must be the same here and in configure.in!
version=2.0beta1

if test -f Makefile; then
	echo Start with a clean page by doing 'cvs checkout omnetpp'!!!
        exit 1
fi

rm -rf `find . -name CVS -type d`

./_setperm
autoconf

# regenerate samples' makefiles and all dependencies
./configure

(cd bin; ln -s ../src/utils/makemake .)
for i in samples/*; do
	(cd $i; make re-makemake; make re-makemake-m; make depend; rm Makefile)
done
for i in sim/*; do
	if test -f $i/Makefile.in; then
		(cd $i; make depend; rm Makefile)
	fi
done
rm bin/makemake

# cleanup
rm _setperm
rm _makedist
rm -rf _icons
rm config.*
rm -rf src/gned/icons
rm -rf `find . -name Makefile`
rm -rf `find . -name '*.bak'`

# pack
cd ..
mv omnetpp omnetpp-$version
tar cvfz omnetpp-$version.tgz omnetpp-$version

