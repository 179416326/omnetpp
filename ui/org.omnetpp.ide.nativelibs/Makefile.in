#
# Global definitions
#
OMNETPP_ROOT=@OMNETPP_ROOT@
OMNETPP_INCL_DIR=@OMNETPP_INCL_DIR@
OMNETPP_LIB_DIR=@OMNETPP_LIB_DIR@

JAVA_CFLAGS=@JAVA_CFLAGS@
SWIG=@SWIG@

COMMON=$(OMNETPP_ROOT)/src/common
NEDXML=$(OMNETPP_ROOT)/src/nedxml
SCAVE=$(OMNETPP_ROOT)/src/scave
LAYOUT=$(OMNETPP_ROOT)/src/layout
EVENTLOG=$(OMNETPP_ROOT)/src/eventlog

COMMON_JAVAPKG = org.omnetpp.common.engine
NEDXML_JAVAPKG = org.omnetpp.ned.engine
SCAVE_JAVAPKG = org.omnetpp.scave.engine
LAYOUT_JAVAPKG = org.omnetpp.layout.engine
EVENTLOG_JAVAPKG = org.omnetpp.eventlog.engine

COMMON_JAVADIR = src/$(COMMON_JAVAPKG)
NEDXML_JAVADIR = src/$(NEDXML_JAVAPKG)
SCAVE_JAVADIR = src/$(SCAVE_JAVAPKG)
LAYOUT_JAVADIR = src/$(LAYOUT_JAVAPKG)
EVENTLOG_JAVADIR = src/$(EVENTLOG_JAVAPKG)

SWIGFILES = common.i nedxml.i scave.i layout.i eventlog.i
CXXFILES = $(SWIGFILES:.i=.cxx)
OBJS = $(CXXFILES:.cxx=.o)

LIBS=-L$(OMNETPP_LIB_DIR) -lcommon -lnedxml -lscave -llayout -leventlog

DLL = opplibs$(SO_LIB_SUFFIX)

DLL_TARGET_DIR = ../org.omnetpp.ide.nativelibs.linux.x86


#
# Local definitions
#
INCLUDES=-I$(COMMON) -I$(NEDXML) -I$(SCAVE) -I$(LAYOUT) -I$(EVENTLOG) -I$(OMNETPP_INCL_DIR)/platdep
COPTS=$(CFLAGS) $(JAVA_CFLAGS) $(INCLUDES)


#
# Automatic rules
#
.SUFFIXES : .cc .cxx

.cc.o:
	$(CXX) -c $(COPTS) $<

.cxx.o:
	$(CXX) -c $(COPTS) $<

#
# Targets. NOTE: cmd.exe "Command Extensions" must be enabled for "mkdir" commands to work!
#
all: $(DLL)

common.cxx : common.i
	-rm -f $(COMMON_JAVADIR)/*.java
	-mkdir $(COMMON_JAVADIR)
	$(SWIG) -c++ -java $(INCLUDES) -package $(COMMON_JAVAPKG) -outdir $(COMMON_JAVADIR) -o $@ $<

nedxml.cxx : nedxml.i
	-rm -f $(NEDXML_JAVADIR)/*.java
	-mkdir $(NEDXML_JAVADIR)
	$(SWIG) -c++ -java $(INCLUDES) -package $(NEDXML_JAVAPKG) -outdir $(NEDXML_JAVADIR) -o $@ $<

scave.cxx : scave.i
	-rm -f $(SCAVE_JAVADIR)/*.java
	-mkdir $(SCAVE_JAVADIR)
	$(SWIG) -c++ -java $(INCLUDES) -package $(SCAVE_JAVAPKG) -outdir $(SCAVE_JAVADIR) -o $@ $<

layout.cxx : layout.i
	-rm -f $(LAYOUT_JAVADIR)/*.java
	-mkdir $(LAYOUT_JAVADIR)
	$(SWIG) -c++ -java $(INCLUDES) -package $(LAYOUT_JAVAPKG) -outdir $(LAYOUT_JAVADIR) -o $@ $<

eventlog.cxx : eventlog.i
	-rm -f $(EVENTLOG_JAVADIR)/*.java
	-mkdir $(EVENTLOG_JAVADIR)
	$(SWIG) -c++ -java $(INCLUDES) -package $(EVENTLOG_JAVAPKG) -outdir $(EVENTLOG_JAVADIR) -o $@ $<

$(DLL): $(OBJS)
	$(SHLIB_LD) -o $(DLL) $(OBJS)
	cp $(DLL) $(DLL_TARGET_DIR)

depend:
	$(MAKEDEPEND) $(INCLUDES) -fMakefile -- *.cxx *.cc

clean:
	-rm -f *.cxx *.o *.a *.so
# DO NOT DELETE THIS LINE -- make depend depends on it.

