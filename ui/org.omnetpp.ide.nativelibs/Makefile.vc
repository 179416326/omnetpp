#
# Global definitions
#
OMNETPP_ROOT=..\..

!include $(OMNETPP_ROOT)\configuser.vc

JDK="$(TOOLS_DIR)\jdk1.5.0"
SWIG="$(TOOLS_DIR)\SWIG-1.3.25\swig.exe"
#SWIG="$(TOOLS_DIR)\SWIGWIN-1.3.31\swig.exe"

COMMON=$(OMNETPP_ROOT)\src\common
NEDXML=$(OMNETPP_ROOT)\src\nedxml
SCAVE=$(OMNETPP_ROOT)\src\scave
LAYOUT=$(OMNETPP_ROOT)\src\layout
EVENTLOG=$(OMNETPP_ROOT)\src\eventlog

COMMON_JAVAPKG = org.omnetpp.common.engine
NEDXML_JAVAPKG = org.omnetpp.ned.engine
SCAVE_JAVAPKG = org.omnetpp.scave.engine
LAYOUT_JAVAPKG = org.omnetpp.layout.engine
EVENTLOG_JAVAPKG = org.omnetpp.eventlog.engine

COMMON_JAVADIR = src\$(COMMON_JAVAPKG:.=\)
NEDXML_JAVADIR = src\$(NEDXML_JAVAPKG:.=\)
SCAVE_JAVADIR = src\$(SCAVE_JAVAPKG:.=\)
LAYOUT_JAVADIR = src\$(LAYOUT_JAVAPKG:.=\)
EVENTLOG_JAVADIR = src\$(EVENTLOG_JAVAPKG:.=\)

SWIGFILES = common.i nedxml.i scave.i layout.i eventlog.i
CXXFILES = $(SWIGFILES:.i=.cxx)
OBJS = $(CXXFILES:.cxx=.obj)

LIBS=/libpath:$(OMNETPP_LIB_DIR) common.lib nedxml.lib scave.lib layout.lib eventlog.lib

DLL = opplibs.dll

DLL_TARGET_DIR = ..\org.omnetpp.ide.nativelibs.win32.x86


#
# Local definitions
#
INCLUDES=-I$(COMMON) -I$(NEDXML) -I$(SCAVE) -I$(LAYOUT) -I$(EVENTLOG) -I$(OMNETPP_INCL_DIR)/platdep
COPTS=$(CFLAGS) -I$(JDK)\include -I$(JDK)\include\win32 $(INCLUDES)


#
# Automatic rules
#
.SUFFIXES : .cc .cxx

.cc.obj:
	$(CXX) /Fo"$@" $(COPTS) /c /Tp $<

.cxx.obj:
	$(CXX) /Fo"$@" $(COPTS) /c /Tp $<

#
# Targets. NOTE: cmd.exe "Command Extensions" must be enabled for "mkdir" commands to work!
#
all: $(DLL)

common.cxx : common.i
	-del $(COMMON_JAVADIR)\*.java >nul
	-mkdir $(COMMON_JAVADIR) >nul
	$(SWIG) -c++ -java $(INCLUDES) -package $(COMMON_JAVAPKG) -outdir $(COMMON_JAVADIR) -o $@ $**

nedxml.cxx : nedxml.i
	-del $(NEDXML_JAVADIR)\*.java >nul
	-mkdir $(NEDXML_JAVADIR) >nul
	$(SWIG) -c++ -java $(INCLUDES) -package $(NEDXML_JAVAPKG) -outdir $(NEDXML_JAVADIR) -o $@ $**

scave.cxx : scave.i
	-del $(SCAVE_JAVADIR)\*.java >nul
	-mkdir $(SCAVE_JAVADIR) >nul
	$(SWIG) -c++ -java $(INCLUDES) -package $(SCAVE_JAVAPKG) -outdir $(SCAVE_JAVADIR) -o $@ $**

layout.cxx : layout.i
	-del $(LAYOUT_JAVADIR)\*.java >nul
	-mkdir $(LAYOUT_JAVADIR) >nul
	$(SWIG) -c++ -java $(INCLUDES) -package $(LAYOUT_JAVAPKG) -outdir $(LAYOUT_JAVADIR) -o $@ $**

eventlog.cxx : eventlog.i
	-del $(EVENTLOG_JAVADIR)\*.java >nul
	-mkdir $(EVENTLOG_JAVADIR) >nul
	$(SWIG) -c++ -java $(INCLUDES) -package $(EVENTLOG_JAVAPKG) -outdir $(EVENTLOG_JAVADIR) -o $@ $**

$(DLL): $(OBJS)
	$(LINK) /dll /out:$(DLL) $(OBJS) $(LIBS) $(LDFLAGS)
	copy $(DLL) $(DLL_TARGET_DIR)

depend:
	$(MAKEDEPEND) $(INCLUDES) -fMakefile.vc -- *.cxx *.cc

clean:
	-del *.cxx *.obj *.exp *.lib test*.exe *.dll 2>nul
	-del *.ilk *.idb *.pdb *.pch 2>nul
# DO NOT DELETE THIS LINE -- make depend depends on it.

