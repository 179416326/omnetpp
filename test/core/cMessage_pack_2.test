%description:
Tests cMessage.parsimPack/parsimUnpack and msg encapsulation.

%includes:
#include <string.h>
#include "../src/sim/parsim/cfilecommbuffer.h"

%activity:

#define PRINT(X)  ev << #X << ":" << (X) << endl

cFileCommBuffer *buffer = new cFileCommBuffer();

cMessage *payload = new cMessage("payload");
payload->setBitLength(123);

cMessage msg("msg");
msg.setBitLength(1500);
msg.encapsulate(payload);
msg.parsimPack(buffer);

cMessage msg2("tmp");
msg2.parsimUnpack(buffer);
ev << "isBufferEmpty:" << buffer->isBufferEmpty() << endl;

PRINT(msg2.getName());
PRINT(msg2.getBitLength());
PRINT(msg2.getEncapsulatedMsg()==NULL);

cMessage *payload2 = msg2.decapsulate();
PRINT(payload2->getName());
PRINT(payload2->getBitLength());

%contains: stdout
isBufferEmpty:1
msg2.getName():msg
msg2.getBitLength():1623
msg2.getEncapsulatedMsg()==NULL:0
payload2->getName():payload
payload2->getBitLength():123

