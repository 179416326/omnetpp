%description:
Test that when simple modules get stage==0 initialized, channels are already
initialized.

%file: test.ned

channel MyConn extends ned.BasicChannel
{
    parameters:
        delay = 1;
        datarate = 1000;
}

simple Node1
{
    gates:
        output out;
}

simple Node2
{
    gates:
        input in;
}

network Test
{
    submodules:
        node1: Node1;
        node2: Node2;
    connections:
        node1.out --> MyConn --> node2.in;
}

%file: test.cc

#include <omnetpp.h>

namespace {} {

class Node1 : public cSimpleModule
{
    virtual void initialize();
    virtual void handleMessage(cMessage *msg);
};

Define_Module(Node1);

void Node1::initialize()
{
    for (int i=0; i<5; i++)
    {
        cMessage *msg = new cMessage();
        msg->setLength(100); // so transmission time = 0.1s
        send(msg, "out");
    }
}

void Node1::handleMessage(cMessage *msg)
{
    ASSERT(false);
}

class Node2 : public cSimpleModule
{
    virtual void handleMessage(cMessage *msg);
};

Define_Module(Node2);

void Node2::handleMessage(cMessage *msg)
{
    ev << "msg arrived at T=" << simTime();
    delete msg;
}

}; //namespace

%inifile: test.ini
[General]
network = Test
cmdenv-express-mode = false
cmdenv-event-banners = false

%contains: stdout
msg arrived at T=1.1
msg arrived at T=1.2
msg arrived at T=1.3
msg arrived at T=1.4
msg arrived at T=1.5

