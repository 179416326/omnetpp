%description:
Tests MatchExpression class.

%global:

#include "../../../src/common/matchexpression.h"

// global vars
static bool dottedpath;
static bool fullstring;
static bool casesensitive;

static void match(const char *pattern, const char *line, bool expectedresult)
{
    MatchExpression me;
    me.setPattern(pattern, dottedpath, fullstring, casesensitive);
    MatchableString lineObject(line);
    bool result;
    try {
        result = me.matches(&lineObject);
    } catch (Exception *e) {
        ev.printf("%s match %s : EXCEPTION: %s\n", pattern, line, e->message());
        return;
    }
    ev.printf("%s match %s: %s %s\n", pattern, line, (result?"true":"false"), (result==expectedresult?"ok":"FAIL"));
}


%activity:

dottedpath = true;
fullstring = true;
casesensitive = true;

match("a", "a", true);
match("a", "b", false);

match("a|b", "a", true);
match("b|a", "a", true);
match("a|b", "c", false);

match("a | b", "a", true);
match("b | a", "a", true);
match("a | b", "c", false);


%exitcode: 0

%contains: stdout
BUBU (remove this!)

%not-contains: stdout
FAIL

%not-contains: stdout
EXCEPTION

