%description:
Check that structs work in msg files

%file: {}.msg

struct {MyStruct}
{
    fields:
        bool b;
        char c;
        short s;
        unsigned short us;
        int i;
        unsigned int ui;
        long l;
        unsigned long ul;
        double d;

        bool bb[10];
        char cc[20];
        short ss[30];
        unsigned short uss[31];
        int ii[40];
        unsigned int uii[41];
        long ll[50];
        unsigned long ull[51];
        double dd[60];
};

%global:
#include "{}_m.h"

%activity:

#define PRINT(X) ev << #X << ":" << X << endl
#define PRINTA(X) ev << #X << ":" << X[0] << ":" << sizeof(X)/sizeof(X[0]) << endl;

{MyStruct} x;

// scalars
x.b = true; PRINT(x.b);
x.b = false; PRINT(x.b);

x.c = 'a'; PRINT(x.c);

x.s = 10;  PRINT(x.s);
x.s = -10;  PRINT(x.s);
x.us = 10;  PRINT(x.us);
x.us = -10;  PRINT((x.us>0));

x.i = 10;  PRINT(x.i);
x.i = -10;  PRINT(x.i);
x.ui = 10;  PRINT(x.ui);
x.ui = -10;  PRINT((x.ui>0));

x.l = 10;  PRINT(x.l);
x.l = -10;  PRINT(x.l);
x.ul = 10;  PRINT(x.ul);
x.ul = -10;  PRINT((x.ul>0));

x.d = 3.1415; PRINT(x.d);

// arrays
x.bb[0] = true; PRINTA(x.bb);
x.bb[0] = false; PRINTA(x.bb);

x.cc[0] = 'a'; PRINTA(x.cc);

x.ss[0] = 10;  PRINTA(x.ss);
x.ss[0] = -10;  PRINTA(x.ss);
x.uss[0] = 10;  PRINTA(x.uss);
x.uss[0] = -10;  PRINT((x.uss[0]>0));

x.ii[0] = 10;  PRINTA(x.ii);
x.ii[0] = -10;  PRINTA(x.ii);
x.uii[0] = 10;  PRINTA(x.uii);
x.uii[0] = -10;  PRINT((x.uii[0]>0));

x.ll[0] = 10;  PRINTA(x.ll);
x.ll[0] = -10;  PRINTA(x.ll);
x.ull[0] = 10;  PRINTA(x.ull);
x.ull[0] = -10;  PRINT((x.ull[0]>0));

x.dd[0] = 3.1415; PRINTA(x.dd);

%contains: stdout
x.b:1
x.b:0
x.c:a
x.s:10
x.s:-10
x.us:10
(x.us>0):1
x.i:10
x.i:-10
x.ui:10
(x.ui>0):1
x.l:10
x.l:-10
x.ul:10
(x.ul>0):1
x.d:3.1415
x.bb:1:10
x.bb:0:10
x.cc:a:20
x.ss:10:30
x.ss:-10:30
x.uss:10:31
(x.uss[0]>0):1
x.ii:10:40
x.ii:-10:40
x.uii:10:41
(x.uii[0]>0):1
x.ll:10:50
x.ll:-10:50
x.ull:10:51
(x.ull[0]>0):1
x.dd:3.1415:60

